# Java

## Concurrency
<b>Атомарность</b> - инкремент неатомарная операция т.к нужно прочитать, изменить значение, записать.

<b>Race condition</b> - состояние гонки. Нужно синхронизировать и делать объект неизменяемым, чтобы он мог правильно работать в многопоточной среде. 

<b>Синхронизация потоков</b>
- Ключевое слово synchronized
- Mutex - это объект для синхронизации потоков. Используется для того, чтобы обеспечить доступ к объекту в опр-е время был только у одного потока.
- Monitor - это дополнительная настройка над Мutex. В Java невидимый для программиста кусок кода. Защитный механизм создает именно Monitor. Компилятор преобразует слово synchronized.
- Mutex - это одноместный семафор.
- По сути Monitor является слово synchronized

<b>Видимость (memory visibility)</b>
- Т.к существует переупорядочивание reordering, то без синхронизации нет гарантии, что операции будут выполняться в заданном порядке.
- Переупорядочивание reordering для оптимизации

<b>Устаревшие данные (stale data)</b>

<b>Блокировка и видимость</b> 
- Без синхронизации видимость не гарантирована
- Гарантия видимости еще одна причина синхронизации всех потоков на одинаковом замке во время доступа к совместной мутируемой переменной. Чтобы обеспечить видимость актуальных значений совместных волотильных переменных, синхронизируйте читающие и пишущие потоки на общем замке.

<b>Волотильные переменные (volatile)</b> - слабая форма синхронизации
- Они не кешируются в регистрах или кешах, записываются напрямую в память
- Пример использования, инициализация или выключение.
- !!! Особенность, увидят все изменение т.е чтение, но обращение к переменной не блокирует ее. Получается, что volatile недостаточно силен, чтобы сделать операцию инкремент атомарной в многопоточной среде
- !!! Синхронизация может гарантировать <b>видимость и атомарность</b>, а volatile гарантируют только <b>видимость</b>.
- Когда использовать: запись в переменную не зависят от ее текущего значения, либо есть гарантия, что значение переменной обновляется одним потоком. При обращении к переменной не требуется блокировка.